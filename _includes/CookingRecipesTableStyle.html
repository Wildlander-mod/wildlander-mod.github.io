

<div class="cooking-recipes-controls">
  <input type="text" id="cookingRecipesSearch" placeholder="Search (Item Name, Effects, Requirements)..." />
  <select id="typeFilter">
    <option value="">All Types</option>
  </select>
  <select id="toolkitFilter">
    <option value="">All Toolkits</option>
  </select>
  <select id="perksFilter">
    <option value="">All Perks</option>
  </select>
  <button id="clearFiltersRecipes" onclick="clearCookingRecipesFilters()">Clear Filters</button>
</div>
<div class="filter-result-count-recipes" id="filterResultCountRecipes"></div>

<script>
function initCookingRecipesFilters() {
  const table = document.querySelector('.cooking-recipes-table table');
  if (!table) return;
  
  const rows = Array.from(table.querySelectorAll('tbody tr'));
  const types = new Set();
  const toolkits = new Set();
  const perks = new Set();
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 7) {
      const type = cells[1].textContent.trim();
      const toolkit = cells[6].textContent.trim();
      const perk = cells[5].textContent.trim();
      if (type) types.add(type);
      if (toolkit) toolkits.add(toolkit);
      if (perk) perks.add(perk);
    }
  });
  
  const typeSelect = document.getElementById('typeFilter');
  const toolkitSelect = document.getElementById('toolkitFilter');
  const perksSelect = document.getElementById('perksFilter');
  
  Array.from(types).sort().forEach(t => {
    const option = document.createElement('option');
    option.value = t;
    option.textContent = t;
    typeSelect.appendChild(option);
  });
  
  Array.from(toolkits).sort().forEach(tk => {
    const option = document.createElement('option');
    option.value = tk;
    option.textContent = tk;
    toolkitSelect.appendChild(option);
  });
  
  Array.from(perks).sort().forEach(perk => {
    const option = document.createElement('option');
    option.value = perk;
    option.textContent = perk;
    perksSelect.appendChild(option);
  });
  
  document.getElementById('cookingRecipesSearch').addEventListener('input', filterCookingRecipesTable);
  typeSelect.addEventListener('change', filterCookingRecipesTable);
  toolkitSelect.addEventListener('change', filterCookingRecipesTable);
  perksSelect.addEventListener('change', filterCookingRecipesTable);
  
  initCookingRecipesTooltips();
  
  updateFilterCountRecipes();
}

function initCookingRecipesTooltips() {
  const table = document.querySelector('.cooking-recipes-table table');
  if (!table) return;
  
  let tooltip = document.getElementById('cookingRecipesTooltip');
  if (!tooltip) {
    tooltip = document.createElement('div');
    tooltip.id = 'cookingRecipesTooltip';
    tooltip.className = 'recipe-tooltip';
    document.body.appendChild(tooltip);
  }
  
  const rows = table.querySelectorAll('tbody tr');
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length < 9) return;
    
    const itemNameCell = cells[0];
    const itemName = cells[0].textContent.trim();
    const itemType = cells[1].textContent.trim();
    const effects = cells[2].textContent.trim();
    const itemsRequired = cells[3].textContent.trim();
    const qtyMade = cells[4].textContent.trim();
    const perksNeeded = cells[5].textContent.trim();
    const toolkitsRequired = cells[6].textContent.trim();
    const proximity = cells[7].textContent.trim();
    const additionalRequirements = cells[8].textContent.trim();
    
    itemNameCell.addEventListener('mouseenter', (e) => {
      showCookingRecipesTooltip(e, {itemName, itemType, effects, itemsRequired, qtyMade, perksNeeded, toolkitsRequired, proximity, additionalRequirements});
    });
    
    itemNameCell.addEventListener('mouseleave', hideCookingRecipesTooltip);
  });
}

function showCookingRecipesTooltip(event, data) {
  const tooltip = document.getElementById('cookingRecipesTooltip');
  if (!tooltip) return;
  
  tooltip.innerHTML = `
    <div class="recipe-tooltip-header">
      <div class="recipe-tooltip-name">${data.itemName}</div>
    </div>
    ${data.itemType ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Type</span>
      <div class="recipe-tooltip-value">${data.itemType}</div>
    </div>` : ''}
    ${data.effects ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Effects</span>
      <div class="recipe-tooltip-value">${data.effects}</div>
    </div>` : ''}
    ${data.itemsRequired ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Items Required</span>
      <div class="recipe-tooltip-value">${data.itemsRequired}</div>
    </div>` : ''}
    ${data.qtyMade ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Qty Made</span>
      <div class="recipe-tooltip-value">${data.qtyMade}</div>
    </div>` : ''}
    ${data.perksNeeded ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Perks Needed</span>
      <div class="recipe-tooltip-value">${data.perksNeeded}</div>
    </div>` : ''}
    ${data.toolkitsRequired ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Toolkits Required</span>
      <div class="recipe-tooltip-value">${data.toolkitsRequired}</div>
    </div>` : ''}
    ${data.proximity ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Proximity/Location</span>
      <div class="recipe-tooltip-value">${data.proximity}</div>
    </div>` : ''}
    ${data.additionalRequirements ? `<div class="recipe-tooltip-row">
      <span class="recipe-tooltip-label">Additional Requirements</span>
      <div class="recipe-tooltip-value">${data.additionalRequirements}</div>
    </div>` : ''}
  `;
  
  tooltip.classList.add('active');
  
  const rect = event.target.getBoundingClientRect();
  let left = rect.left;
  let top = rect.bottom + 8;
  
  // Adjust if tooltip goes off-screen
  if (left + 620 > window.innerWidth) {
    left = window.innerWidth - 620;
  }
  if (left < 10) {
    left = 10;
  }
  
  tooltip.style.left = left + 'px';
  tooltip.style.top = top + 'px';
}

function hideCookingRecipesTooltip() {
  const tooltip = document.getElementById('cookingRecipesTooltip');
  if (tooltip) {
    tooltip.classList.remove('active');
  }
}

function filterCookingRecipesTable() {
  const table = document.querySelector('.cooking-recipes-table table');
  if (!table) return;
  
  const searchTerm = document.getElementById('cookingRecipesSearch').value.toLowerCase();
  const typeFilter = document.getElementById('typeFilter').value;
  const toolkitFilter = document.getElementById('toolkitFilter').value;
  const perksFilter = document.getElementById('perksFilter').value;
  
  const rows = table.querySelectorAll('tbody tr');
  let visibleCount = 0;
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length < 9) return;
    
    const itemName = cells[0].textContent.toLowerCase();
    const type = cells[1].textContent.trim();
    const effects = cells[2].textContent.toLowerCase();
    const itemsRequired = cells[3].textContent.toLowerCase();
    const toolkit = cells[6].textContent.trim();
    const perks = cells[5].textContent.trim();
    
    const matchesSearch = !searchTerm || 
                         itemName.includes(searchTerm) ||
                         effects.includes(searchTerm) ||
                         itemsRequired.includes(searchTerm);
    
    const matchesType = !typeFilter || type === typeFilter;
    const matchesToolkit = !toolkitFilter || toolkit === toolkitFilter;
    const matchesPerks = !perksFilter || perks === perksFilter;
    
    const isVisible = matchesSearch && matchesType && matchesToolkit && matchesPerks;
    
    if (isVisible) {
      row.classList.remove('hidden');
      visibleCount++;
    } else {
      row.classList.add('hidden');
    }
  });
  
  updateFilterCountRecipes(visibleCount, rows.length);
}

function updateFilterCountRecipes(visible, total) {
  const table = document.querySelector('.cooking-recipes-table table');
  if (!table) return;
  
  if (visible === undefined) {
    visible = table.querySelectorAll('tbody tr:not(.hidden)').length;
    total = table.querySelectorAll('tbody tr').length;
  }
  
  const countElement = document.getElementById('filterResultCountRecipes');
  if (countElement) {
    countElement.textContent = `Showing ${visible} of ${total} recipes`;
  }
}

function clearCookingRecipesFilters() {
  document.getElementById('cookingRecipesSearch').value = '';
  document.getElementById('typeFilter').value = '';
  document.getElementById('toolkitFilter').value = '';
  document.getElementById('perksFilter').value = '';
  filterCookingRecipesTable();
}

document.addEventListener('DOMContentLoaded', initCookingRecipesFilters);

// Fallback: if DOMContentLoaded already fired or table isn't ready, retry
setTimeout(() => {
  if (!document.querySelector('.cooking-recipes-table table')) {
    initCookingRecipesFilters();
  }
}, 100);
</script>

<div class="cooking-recipes-table" markdown="1">
